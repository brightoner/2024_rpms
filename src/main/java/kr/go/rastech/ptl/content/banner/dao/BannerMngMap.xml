<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.rastech.ptl.content.banner.dao.BannerMngDao">
 <sql id="getPagingSelect">
   SELECT  @rownum:=@rownum+1 as  data_seq, A.*
     FROM (
 </sql>

 <sql id="getPagingWhere">
 <![CDATA[
             ) A		 
	    LIMIT #{length, jdbcType=INTEGER} OFFSET #{start, jdbcType=INTEGER}
 ]]>
 </sql>
 
	<select id="selectBannerList"  parameterType="java.util.Map"  resultType="kr.go.rastech.commons.utils.LowerKeyMap">
 	 	<include refid="getPagingSelect"></include>
 	/* selectBannerList */ 	
	 SELECT  a.banner_seq
		  ,  a.banner_title
		  ,  a.banner_contents
		  ,  a.use_yn
		  ,  a.atch_img_id
		  ,  date_format(a.REG_DATE,'%Y-%m-%d') AS create_dttm_al
		  ,  date_format(a.EDIT_DATE,'%Y-%m-%d') AS edit_date_al
		/*  , (SELECT p.atch_img_id FROM ptl_atch_img p  WHERE p.atch_img_id = a.atch_img_id  AND p.use_yn = 'Y' ) AS img_yn */ 
		  , (CASE WHEN (SELECT p.atch_img_id FROM ptl_atch_img p  WHERE p.atch_img_id = a.atch_img_id  AND p.use_yn = 'Y' ) IS NOT NULL THEN 'Y' ELSE 'N' END  ) AS  img_yn		  		  
	   FROM  PTL_BANNER a , (SELECT @rownum:= #{rownum, jdbcType=INTEGER}) B     
	  WHERE  1 = 1		
		<if test='searchopt == "pu_subject" ' >
	    	AND a.BANNER_TITLE like concat('%',#{searchword},'%')
		</if>
		<if test='searchopt == "pu_contents" '>
		    AND a.BANNER_CONTENTS like concat('%',#{searchword},'%')
		</if>		
		ORDER BY a.banner_seq DESC
	 	<include refid="getPagingWhere"></include>
	</select>
	
	<select id="selectBannerTotalCount"  parameterType="java.util.Map"  resultType="integer">
		SELECT count(*) as cnt   		  		  	
		FROM
		    PTL_BANNER
		WHERE 1 = 1		
		<if test='searchopt == "pu_subject" ' >
		    AND BANNER_TITLE like concat('%',#{searchword},'%')
		</if>
		<if test='searchopt == "pu_contents" '>
		    AND BANNER_CONTENTS like concat('%',#{searchword},'%')
		</if>		
	
	</select>
	
	
	<select id="selectBannerDtl"  parameterType="java.util.Map"  resultType="kr.go.rastech.commons.utils.LowerKeyMap">
		SELECT
		    banner_seq	
		  , banner_title
		  , banner_contents		
		  , atch_img_id 
		  , use_yn
		  , date_format(REG_DATE,'%Y-%m-%d') AS create_dttm_al
		  , date_format(EDIT_DATE,'%Y-%m-%d') AS edit_date_al   	  		  	
		FROM PTL_BANNER
		WHERE banner_seq=  #{banner_seq, jdbcType=INTEGER}
	</select>	
	
	
	<select id="selectMainBannerList"  parameterType="java.util.Map"  resultType="kr.go.rastech.commons.utils.LowerKeyMap">
 	 
	 	/* selectMainBannerList */ 	
		 SELECT  a.banner_seq
			  ,  a.banner_title
			  ,  a.banner_contents
			  ,  a.atch_img_id
			  ,  date_format(a.REG_DATE,'%Y-%m-%d') AS create_dttm_al
			  ,  date_format(a.EDIT_DATE,'%Y-%m-%d') AS edit_date_al
			/*  , (SELECT p.atch_img_id FROM ptl_atch_img p  WHERE p.atch_img_id = a.atch_img_id  AND p.use_yn = 'Y' ) AS img_yn */ 
			  , (CASE WHEN (SELECT p.atch_img_id FROM ptl_atch_img p  WHERE p.atch_img_id = a.atch_img_id  AND p.use_yn = 'Y' ) IS NOT NULL THEN 'Y' ELSE 'N' END  ) AS  img_yn		  		  
		   FROM  PTL_BANNER a 
		  WHERE  1 = 1		 
		    AND a.USE_YN = 'Y'
	   ORDER BY a.banner_seq DESC
	
	</select>
	
	<select id="selectBannerSeq" resultType="integer">
		SELECT IFNULL(MAX(BANNER_SEQ),0)+1 FROM PTL_BANNER a
	</select>
	
	<insert id="insertBannerMng" parameterType="java.util.Map">
		INSERT INTO PTL_BANNER (
			  BANNER_SEQ
			, BANNER_TITLE
			, BANNER_CONTENTS
			, USE_YN
			, ATCH_IMG_ID
			, REG_DATE
		) VALUES (
			   #{banner_seq}
			,  #{banner_title, jdbcType = VARCHAR}
			,  #{banner_contents, jdbcType = VARCHAR}
			,  #{use_yn, jdbcType = VARCHAR}
			,  #{atch_img_id, jdbcType = VARCHAR}
			,  now()			
		)
	</insert>
	
		<update id="updateBannerMng" parameterType="java.util.Map">
		UPDATE PTL_BANNER SET 
			  BANNER_TITLE = #{banner_title, jdbcType = VARCHAR}
			, BANNER_CONTENTS = #{banner_contents, jdbcType = VARCHAR}			
			, ATCH_IMG_ID=	#{atch_img_id, jdbcType = VARCHAR}
			, USE_YN=	#{use_yn, jdbcType = VARCHAR}
			, EDIT_DATE = now()	
		WHERE 1 = 1 
			AND BANNER_SEQ =  #{banner_seq, jdbcType=INTEGER}
	</update>
	
	
	<update id="updateBannerImgFile" parameterType="java.util.Map">
		<![CDATA[
			UPDATE	PTL_BANNER	SET
				    ATCH_IMG_ID=''
 			 WHERE  BANNER_SEQ =  #{banner_seq, jdbcType=INTEGER}
 			
		]]>
	</update>
	
	<delete id="deleteBanner" parameterType="java.util.Map">
		DELETE FROM PTL_BANNER WHERE BANNER_SEQ = #{banner_seq, jdbcType=INTEGER}
	</delete>
	
</mapper>
