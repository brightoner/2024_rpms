<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.go.rastech.ptl.follow.year.planInfo.dao.PlanInfoDao">
 <sql id="getPagingSelect">
   SELECT  @rownum:=@rownum+1 as  data_seq, D.*
     FROM (
 </sql>

 <sql id="getPagingWhere">
 <![CDATA[
             ) D		 
	    LIMIT #{length, jdbcType=INTEGER} OFFSET #{start, jdbcType=INTEGER}
 ]]>
 </sql>
 
 	<!-- 연차사후관리 기본정보 list -->
	<select id="selectPlanInfoList"  parameterType="java.util.Map"  resultType="kr.go.rastech.commons.utils.LowerKeyMap">
 	/* selectPlanInfoList */ 	
		<include refid="getPagingSelect"></include>
		SELECT A.PROJ_ID
             , A.PROJ_YEAR_ID
             , A.PROJ_YEAR_GB
             , A.PROJ_STEP_GB
             , A.PROJ_RECPT_NO 
             , A.PROJ_TYPE_CD 
             , A.RND_GB
             , A.TOT_COST 
             , A.GOV_COST 
             , A.CASH 
             , A.STOCK
             , A.TECH_CLS_CD1
             , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD1 ) AS TECH_CLS_NM1
             , A.WEIGHT1 
             , A.TECH_CLS_CD2 
             , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD2 ) AS TECH_CLS_NM2
             , A.WEIGHT2
		  	 , A.TECH_CLS_CD3
		  	 , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD3 ) AS TECH_CLS_NM3
		  	 , A.WEIGHT3
		  	 , A.SECURTY_LEVL_CD
		     , A.PROJ_NM_KOR 
		     , A.PROJ_NM_ENG
		     , DATE_FORMAT(A.CUR_STRTDT,'%Y-%m-%d') AS CUR_STRTDT
		     , DATE_FORMAT(A.CUR_ENDDT,'%Y-%m-%d') AS CUR_ENDDT
		     , A.CREATE_ID
		     , A.YEAR_FILE_GROUP
		     , B.LEAD_ORG_CD
		     , B.AGMT_GB
		     , DATE_FORMAT(B.AGMT_DT,'%Y-%m-%d') AS AGMT_DT
		     , (SELECT D.ORG_NM FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_NM
		     , (SELECT D.ORG_CRM_NO FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_CRM_NO
		     , (SELECT D.ORG_ADDRESS FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_ADDRESS
		     , C.ANN_ID
		     , C.ANN_NO 
		     , C.ANN_DT 
		     , C.ANN_NM 
		  	 , C.DEPT_ORG
		  	 , C.DDCT_ORG
		  	 , C.FILE_GROUP
		  FROM  PTL_PROJECT_YEAR A
	 LEFT JOIN  PTL_PROJECT B
	 	    ON  A.PROJ_ID = B.PROJ_ID 
	 LEFT JOIN  PTL_ANNOUNCE C
	        ON  B.ANN_ID = C.ANN_ID
	INNER JOIN  (SELECT @rownum:= #{rownum, jdbcType=INTEGER}) R
	 	 WHERE  1=1
	 	   AND  A.DEL_YN ='N'	
	 	   AND  B.AGMT_GB = '1'
	 	<if test="searchoption1 != null and searchoption1 !=''">
		  AND  C.DEPT_ORG = #{searchoption1}
		</if>
		<if test="searchoption2 != null and searchoption2 !=''">
		  AND  C.DDCT_ORG = #{searchoption2}
		</if>
		<if test="searchoption3 != null and searchoption3 !=''">
		  AND  SUBSTRING(A.CUR_STRTDT, 1, 4) = #{searchoption3}
		</if>
		<if test="searchword != null and searchword !=''">
		  AND  A.PROJ_NM_KOR LIKE CONCAT('%', #{searchword}, '%')
		</if>
      ORDER BY  A.CUR_STRTDT DESC, A.PROJ_YEAR_ID DESC
	 	<include refid="getPagingWhere"></include>
	</select>
	
	<!-- 연차사후관리 기본정보 count -->
	<select id="selectPlanInfoListCount"  parameterType="java.util.Map"  resultType="integer">
	/* selectPlanInfoListCount */ 
		SELECT  COUNT(1) AS CNT
	      FROM  ptl_project_year A
	LEFT JOIN  PTL_PROJECT B
		   ON  A.PROJ_ID = B.PROJ_ID 
	LEFT JOIN  PTL_ANNOUNCE C
	       ON  B.ANN_ID = C.ANN_ID
		WHERE  1=1
		  AND  A.DEL_YN ='N'	
		  AND  B.AGMT_GB = '1'
		<if test="searchoption1 != null and searchoption1 !=''">
		  AND  C.DEPT_ORG = #{searchoption1}
		</if>
		<if test="searchoption2 != null and searchoption2 !=''">
		  AND  C.DDCT_ORG = #{searchoption2}
		</if>
		<if test="searchoption3 != null and searchoption3 !=''">
		  AND  SUBSTRING(A.CUR_STRTDT, 1, 4) = #{searchoption3}
		</if>
		<if test="searchword != null and searchword !=''">
		  AND  A.PROJ_NM_KOR LIKE CONCAT('%', #{searchword}, '%')
		</if>
	</select>
	
	
	<!-- 연차사후관리 기본정보 상세보기 -->
	<select id="selectPlanInfoDtl"  parameterType="java.util.Map"  resultType="kr.go.rastech.commons.utils.LowerKeyMap">
	/* selectPlanInfoDtl */
		SELECT A.PROJ_YEAR_ID 
             , A.PROJ_ID
             , A.PROJ_YEAR_GB
             , A.PROJ_STEP_GB
             , A.PROJ_RECPT_NO 
             , A.PROJ_TYPE_CD 
             , A.RND_GB
             , A.TOT_COST 
             , A.GOV_COST 
             , A.CASH 
             , A.STOCK
             , A.TECH_CLS_CD1
             , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD1 ) AS TECH_CLS_NM1
             , A.WEIGHT1 
             , A.TECH_CLS_CD2 
             , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD2 ) AS TECH_CLS_NM2
             , A.WEIGHT2
		  	 , A.TECH_CLS_CD3
		  	 , (SELECT D.TCLS_NM FROM PTL_TECH_CLS_CODE D WHERE D.TCLS_ID = B.TECH_CLS_CD3 ) AS TECH_CLS_NM3
		  	 , A.WEIGHT3
		  	 , A.SECURTY_LEVL_CD
		     , A.PROJ_NM_KOR 
		     , A.PROJ_NM_ENG
		     , DATE_FORMAT(A.CUR_STRTDT,'%Y-%m-%d') AS CUR_STRTDT
		     , DATE_FORMAT(A.CUR_ENDDT,'%Y-%m-%d') AS CUR_ENDDT
		     , A.CREATE_ID
		     , FN_USER_KEY_INFO(A.CREATE_ID , 'NM') AS USERNAME
		     , DATE_FORMAT(A.CREATE_DTTM,'%Y-%m-%d') as CREATE_DTTM
		     , A.YEAR_FILE_GROUP
		     , B.LEAD_ORG_CD
		     , B.AGMT_GB
		     , DATE_FORMAT(B.AGMT_DT,'%Y-%m-%d') AS AGMT_DT
		     , (SELECT D.ORG_NM FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_NM
		     , (SELECT D.ORG_CRM_NO FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_CRM_NO
		     , (SELECT D.ORG_ADDRESS FROM PTL_ORG_MNG D WHERE D.ORG_ID = B.LEAD_ORG_CD ) AS ORG_ADDRESS
		     , C.ANN_ID
		     , C.ANN_NO 
		     ,  DATE_FORMAT( C.ANN_DT, '%Y-%m-%d') as ANN_DT
		     , C.ANN_NM 
		  	 , C.DEPT_ORG
		  	 , C.DDCT_ORG
		  	 , C.FILE_GROUP
		 FROM  PTL_PROJECT_YEAR A
	LEFT JOIN  PTL_PROJECT B
		   ON  A.PROJ_ID = B.PROJ_ID 
	LEFT JOIN  PTL_ANNOUNCE C
	       ON  B.ANN_ID = C.ANN_ID
		WHERE  1=1
		  AND  A.DEL_YN ='N'	
		  AND  B.AGMT_GB = '1'	
		  AND  A.PROJ_YEAR_ID = #{proj_year_id} 
	</select>	
	
	
	
	
	
	
	
	
</mapper>
